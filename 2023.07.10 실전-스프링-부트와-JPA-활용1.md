## 2023.07.10 실전-스프링-부트와-JPA-활용1



1. 프로젝트 환경설정

   - 프로젝트 생성

     - ```
       프로젝트 경로: C:\Users\USER\Desktop\Project\jpashop
       
       SpringBoot version: 2.7.13
       
       java version: 11
       
       Project: Gradle - Groovy Project
       
       사용 기능: web, thymeleaf, jpa, h2, lombok, validation
       
       groupId: jpabook
       
       artifactId: jpashop
       ```

   - 그래들 빌드 사양

     - ```groovy
       plugins {
       	id 'java'
       	id 'org.springframework.boot' version '2.7.13'
       	id 'io.spring.dependency-management' version '1.0.15.RELEASE'
       }
       
       group = 'jpabook'
       version = '0.0.1-SNAPSHOT'
       
       java {
       	sourceCompatibility = '11'
       }
       
       configurations {
       	compileOnly {
       		extendsFrom annotationProcessor
       	}
       }
       
       repositories {
       	mavenCentral()
       }
       
       dependencies {
       	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
       	implementation 'org.springframework.boot:spring-boot-starter-validation'
       	implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
       	implementation 'org.springframework.boot:spring-boot-starter-web'
       	compileOnly 'org.projectlombok:lombok'
       	runtimeOnly 'com.h2database:h2'
       	annotationProcessor 'org.projectlombok:lombok'
       	testImplementation 'org.springframework.boot:spring-boot-starter-test'
       	//JUnit4 추가
       	testImplementation("org.junit.vintage:junit-vintage-engine") {
       		exclude group: "org.hamcrest", module: "hamcrest-core"
       	}
       }
       
       tasks.named('test') {
       	useJUnitPlatform()
       }
       ```

   - 라이브러리 살펴보기

     - 여기까지 했음

   - View 환경 설정

     - HelloController
     
       - ```java
         package jpabook.jpashop;
         
         import org.springframework.stereotype.Controller;
         import org.springframework.ui.Model;
         import org.springframework.web.bind.annotation.GetMapping;
         
         @Controller
         public class HelloController {
         
             @GetMapping("/hello")
             public String hello(Model model) {
                 model.addAttribute("data", "hello!! world");
                 return "hello";
             }
         }
         ```
     
     - 스프링 부트의 경로설정
     
       - 스프링 부트 thymeleaf viewName 매핑
       - `resources:templates/` +`{ViewName}` + `.html`
       - `\resources\templates\hello.html`
     
     - index.html은 static 폴더에 만들기
     
     - `꿀팁`
     
       - ```
         html을 수정하고 서버를 켰다 껐다하는게 굉장히 귀찮기 때문에 이걸 없앨 방법이 존재함
         
         1. build.gradle의 dependencies에 " implementation 'org.springframework.boot:spring-boot-devtools' "를 추가한다
         
         2. 수정한 html 파일을 Build 메뉴의 recomplie을 클릭해서 새로고침하면 됨
         ```
     
       - ![image-20230710231610759](C:\Users\USER\AppData\Roaming\Typora\typora-user-images\image-20230710231610759.png)
     
   - H2 설정

     - 팁
       - Version 1.4.200를 사용해야한다
     - 사용법
       - ![image-20230711225014238](C:\Users\USER\AppData\Roaming\Typora\typora-user-images\image-20230711225014238.png)
       - ![image-20230711230057044](C:\Users\USER\AppData\Roaming\Typora\typora-user-images\image-20230711230057044.png)
         - 특정 파일(/jpashop.mv.db) 생성된걸 확인하고
       - ![image-20230711225117511](C:\Users\USER\AppData\Roaming\Typora\typora-user-images\image-20230711225117511.png)

   - JPA와 DB 설정 동작확인

     - application.yml 파일 설정

       - ```yaml
         spring:
           datasource:
             url: jdbc:h2:tcp://localhost/~/jpashop
             username: sa
             password:
             driver-class-name: org.h2.Driver
         
           jpa:
             hibernate:
               ddl-auto: create
             properties:
               hibernate:
                 show_sql: true
                 format_sql: true
         
         logging:
           level:
             org.hibernate.SQL: debug
             org.hibernate.type: trace
         ```
     
     - `spring.jpa.hibernate.ddl-auto: create`
     
       - 애플리케이션 실행 시점에 테이블을 drop 하고, 다시 생성
     
     - 오류

       - @Test에 Tractional 설정을 해주지 않았기 때문에 발생
       - ![image-20230711234321963](C:\Users\USER\AppData\Roaming\Typora\typora-user-images\image-20230711234321963.png)
       - javax와 spring 중에서 spring 껄로 `@Transactional`을 추가
     
     - localhost:8082로 h2에 접속가능
     
       - ![image-20230711234626771](C:\Users\USER\AppData\Roaming\Typora\typora-user-images\image-20230711234626771.png)

     - 빌드

       - ```groovy
         ./gradlew clean build
         
         cd build/libs
         
         java -jar jpashop-0.0.1-SNAPSHOT.jar
         ```

     - TIP - 쿼리 파라미터 남기기
     
       - ```yaml
         logging:
           level:
             org.hibernate.type: trace
         ```
     
       - ![image-20230712023134056](C:\Users\USER\AppData\Roaming\Typora\typora-user-images\image-20230712023134056.png)
     
       - ```groovy
         implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.5.6'
         ```
     
     - TIP - build.gradle
     
       - 가끔 보면 dependencies에 숫자로 버전이 있는 라이브러리가 있고 아닌게 있는데 스프링부트에서 해당 부트 버전에 맞는 라이브러리가 무엇인지 설정해놓은 라이브러리는 숫자버전이 없고, 지원하지 않는 라이브러리는 숫자가 있다
     
       - ```groovy
         /* 스프링부트 2.7.13에서 지원하는 라이브러리는 버전정보가 없고, 아니면 버전정보가 있다 */
         plugins {
         	id 'java'
         	id 'org.springframework.boot' version '2.7.13'
         	id 'io.spring.dependency-management' version '1.0.15.RELEASE'
         }
         
         
         dependencies {
         	implementation 'org.springframework.boot:spring-boot-starter-web'
         	implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.5.6'
         }
         
         tasks.named('test') {
         	useJUnitPlatform()
         }
         
         ```
     
       - ![image-20230712023750764](C:\Users\USER\AppData\Roaming\Typora\typora-user-images\image-20230712023750764.png)
     
     - **개발할 때 로그를 많이 남기는건 좋은 습관이지만 운영환경에서 로그를 많이 남기면 성능에 좋지 않기 때문에 항상 운영에서는 해당 로그가 성능이나 보안에 영향을 끼치는지 확인하고 설계해야한다**

2. 도메인 분석 설계(요구사항 분석)

3. 애플리케이션 구현 준비

4. 회원 도메인 개발

5. 상품 도메인 개발

6. 주문 도메인 개발

7. 웹 계층 개발

8. 정리

